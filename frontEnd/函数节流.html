<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端进阶(2) -- 函数节流 | Mr.liu</title>
    <meta name="description" content="函数节流">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="keywords" content="函数节流 节流 函数">
    <link rel="preload" href="/blog/assets/css/0.styles.4be98a1d.css" as="style"><link rel="preload" href="/blog/assets/js/app.d4bb39d4.js" as="script"><link rel="preload" href="/blog/assets/js/7.7ebaa5a1.js" as="script"><link rel="prefetch" href="/blog/assets/js/1.93683c10.js"><link rel="prefetch" href="/blog/assets/js/10.462f139b.js"><link rel="prefetch" href="/blog/assets/js/11.ca473a72.js"><link rel="prefetch" href="/blog/assets/js/12.62453a1b.js"><link rel="prefetch" href="/blog/assets/js/13.c0ba0083.js"><link rel="prefetch" href="/blog/assets/js/14.84653311.js"><link rel="prefetch" href="/blog/assets/js/15.d2be8e22.js"><link rel="prefetch" href="/blog/assets/js/16.a6aade16.js"><link rel="prefetch" href="/blog/assets/js/17.1bb3ee41.js"><link rel="prefetch" href="/blog/assets/js/18.e6d37761.js"><link rel="prefetch" href="/blog/assets/js/19.de284505.js"><link rel="prefetch" href="/blog/assets/js/3.49340d22.js"><link rel="prefetch" href="/blog/assets/js/4.dcdcdce2.js"><link rel="prefetch" href="/blog/assets/js/5.84bc8d16.js"><link rel="prefetch" href="/blog/assets/js/6.3c32eef1.js"><link rel="prefetch" href="/blog/assets/js/8.166397ba.js"><link rel="prefetch" href="/blog/assets/js/9.8b9f3529.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.4be98a1d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="wrap"><div class="theme-container container no-sidebar"><header class="navbar"><div class="nav-header"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/favicon.ico" class="logo"> <span class="site-name can-hide">
        Mr.liu
      </span></a> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/frontEnd/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="/blog/tags/" class="nav-link">Tags</a></div><div class="nav-item"><a href="https://github.com/webfool" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div><div class="nav-item"><a href="/blog/self/" class="nav-link">Self</a></div> <!----></nav> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/frontEnd/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="/blog/tags/" class="nav-link">Tags</a></div><div class="nav-item"><a href="https://github.com/webfool" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div><div class="nav-item"><a href="/blog/self/" class="nav-link">Self</a></div> <!----></nav> <!----></div> <div class="page-container"><div><div class="page card"><div class="content-header"><h1 class="page-title" style="color:#ac3e40;">
        前端进阶(2) -- 函数节流
      </h1> <span class="page-timestamp">2019-03-29 00:00:00</span></div> <div class="content"><p>函数节流的背景、原理和实现
</p> <h3 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h3> <p>开发中经常会遇到有些函数需要被频繁调用，但是太频繁又影响性能，那怎么办呢？这个时候就需要用到函数节流了。</p> <p>什么是函数节流？函数节流就是指将函数的调用时间间隔控制为 &gt;=t。</p> <p>函数节流适合需要频繁调用，但又要限制调用频率的场景：</p> <ul><li>mouseover / keydown</li> <li>DOM 拖拽 等等</li></ul> <h3 id="实现"><a href="#实现" aria-hidden="true" class="header-anchor">#</a> 实现</h3> <p>函数节流有两种实现方式：</p> <ul><li>与上一次执行时间做对比</li> <li>setTimeout 预约执行时间</li></ul> <p>下面具体讲讲两种方式的具体实现以及背后的一些原理和逻辑</p> <h5 id="方式1：与上一次执行时间做对比"><a href="#方式1：与上一次执行时间做对比" aria-hidden="true" class="header-anchor">#</a> 方式1：与上一次执行时间做对比</h5> <p>先上代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> wait<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> previous <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 此处用到了 + 运算符，后面再出一篇文章细讲该符号的一些其它用法</span>
        <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> previous <span class="token operator">&lt;</span> wait<span class="token punctuation">)</span> <span class="token keyword">return</span>
        fn<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
        previous <span class="token operator">=</span> now
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这种实现方式比较直观，不作过多说明</p> <h5 id="方式2：settimeout-预约执行时间"><a href="#方式2：settimeout-预约执行时间" aria-hidden="true" class="header-anchor">#</a> 方式2：setTimeout 预约执行时间</h5> <p>上代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> wait<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> timeout <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout<span class="token punctuation">)</span> <span class="token keyword">return</span>
        <span class="token keyword">let</span> args <span class="token operator">=</span> arguments
        timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            fn<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
            timeout <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>先说一句setTimeout 的功能：在某个时间之后将函数加入事件循环队列。所以通过setTimeout 可以设置当前执行函数与下一函数执行间隔一定时间。</p> <p>回到节流，当一直通过setTimeout 预约函数执行时，为保证预约函数执行间间隔t 时间，需要限制t 时间内不可预约，即预约函数时，设置标识，再在t 时刻执行函数时将标识取消</p> <h5 id="两种方式对比"><a href="#两种方式对比" aria-hidden="true" class="header-anchor">#</a> 两种方式对比</h5> <ul><li>时间戳方式：马上执行，停止触发后不执行</li> <li>setTimeout方式：非马上执行，停止触发后仍会执行一次</li></ul> <h3 id="需求"><a href="#需求" aria-hidden="true" class="header-anchor">#</a> 需求</h3> <p>同时满足：马上执行并且停止之后仍然执行一次。这个需求比较常遇到，在此做个分析。</p> <p>先来一个大前提知识, 看下面代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'box'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> time1 <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'time1'</span><span class="token punctuation">)</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>time2<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> time2 <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'time2'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>点击box一秒之后输出：</p> <div class="language-js extra-class"><pre class="language-js"><code>time1
</code></pre></div><p>分析一下代码：点击box之后分别向定时器线程添加两个定时任务，1000ms之后均加入事件队列，先执行time1, 在time1中通过clearTimeout 将time2清除，然后time2 不执行。这个结果说明，加入事件队列的任务可以通过clearTimeout 清除掉。</p> <p>回到需求，上代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttled</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> wait<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> timeout
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> distance <span class="token operator">=</span> now <span class="token operator">-</span> previous
        <span class="token keyword">if</span> <span class="token punctuation">(</span>distance <span class="token operator">&gt;=</span> wait<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 除了最后一个时间段需要用预约函数，其他时间段均要清除掉</span>
            <span class="token comment">// 加入事件队列之后仍能清除，参照上面大前提分析</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
                timeout <span class="token operator">=</span> <span class="token keyword">null</span>
            <span class="token punctuation">}</span>
            fn<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
            previous <span class="token operator">=</span> now
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 此处实现停止之后再执行一次</span>
            <span class="token comment">// 时间段初始就预约时间段结束时的执行函数，时间段其他时刻不再预约</span>
            <span class="token keyword">let</span> remainTime <span class="token operator">=</span> wait <span class="token operator">-</span> distance
            timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                fn<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
                timeout <span class="token operator">=</span> <span class="token keyword">null</span>
                previous <span class="token operator">=</span> now
            <span class="token punctuation">}</span><span class="token punctuation">,</span> remainTime<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h4> <p>本文介绍了节流的两种实现方式：&quot;时间戳&quot; 和 &quot;setTimeout&quot;。到此我们就介绍了函数频繁执行的两种处理方式：函数防抖 和 函数节流。其中函数防抖属于硬预约（不管是否已预约都要重新预约），函数节流属于软预约（已预约则不再预约）。</p> <p>写得头疼，摸摸头上的头发，发现还在，欣慰欣慰！劝诫大家，趁头发还在就多摸摸，别等秃了望发空流泪。</p></div> <!----> <div class="content page-nav"><p class="inner"><span class="prev">
          ← <a href="/blog/frontEnd/%E5%89%8D%E7%AB%AF%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%88%E4%BA%8C%EF%BC%89%E7%BC%96%E7%A0%81%E7%AF%87.html" class="prev">
            前端文件操作基础知识（二）编码篇
          </a></span> <span class="next"><a href="/blog/frontEnd/%E5%87%BD%E6%95%B0%E9%98%B2%E6%8A%96.html">
            前端进阶(1) -- 函数防抖
          </a> →
        </span></p></div></div> <div id="comment-container"><div class="gt-container"><div class="gt-initing"><i class="gt-loader"></i> <p class="gt-initing-text">Gitalking ...</p></div> <!----> <!----> <div><div class="gt-header"><a class="gt-avatar-github"><span class="gt-ico gt-ico-github"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64 524C64 719.602 189.356 885.926 364.113 947.017 387.65799 953 384 936.115 384 924.767L384 847.107C248.118 863.007 242.674 773.052 233.5 758.001 215 726.501 171.5 718.501 184.5 703.501 215.5 687.501 247 707.501 283.5 761.501 309.956 800.642 361.366 794.075 387.658 787.497 393.403 763.997 405.637 743.042 422.353 726.638 281.774 701.609 223 615.67 223 513.5 223 464.053 239.322 418.406 271.465 381.627 251.142 320.928 273.421 269.19 276.337 261.415 334.458 256.131 394.888 302.993 399.549 306.685 432.663 297.835 470.341 293 512.5 293 554.924 293 592.81 297.896 626.075 306.853 637.426 298.219 693.46 258.054 747.5 262.966 750.382 270.652 772.185 321.292 753.058 381.083 785.516 417.956 802 463.809 802 513.5 802 615.874 742.99 701.953 601.803 726.786 625.381 750.003 640 782.295 640 818.008L640 930.653C640.752 939.626 640 948.664978 655.086 948.665 832.344 888.962 960 721.389 960 524 960 276.576 759.424 76 512 76 264.577 76 64 276.576 64 524Z"></path>
</svg>
</span> <!----></span></a> <div class="gt-header-comment"><textarea placeholder="Leave a comment" class="gt-header-textarea"></textarea> <div class="gt-header-preview markdown-body hide"></div> <div class="gt-header-controls"><a href="https://guides.github.com/features/mastering-markdown/" target="_blank" class="gt-header-controls-tip"><span class="gt-ico gt-ico-tip"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 366.949535c-16.065554 0-29.982212 13.405016-29.982212 29.879884l0 359.070251c0 16.167882 13.405016 29.879884 29.982212 29.879884 15.963226 0 29.879884-13.405016 29.879884-29.879884L541.879884 396.829419C541.879884 380.763865 528.474868 366.949535 512 366.949535L512 366.949535z"
    p-id="3083"></path>
  <path d="M482.017788 287.645048c0-7.776956 3.274508-15.553912 8.80024-21.181973 5.525732-5.525732 13.302688-8.80024 21.181973-8.80024 7.776956 0 15.553912 3.274508 21.079644 8.80024 5.525732 5.62806 8.80024 13.405016 8.80024 21.181973 0 7.776956-3.274508 15.656241-8.80024 21.181973-5.525732 5.525732-13.405016 8.697911-21.079644 8.697911-7.879285 0-15.656241-3.274508-21.181973-8.697911C485.292295 303.301289 482.017788 295.524333 482.017788 287.645048L482.017788 287.645048z"
    p-id="3084"></path>
  <path d="M512 946.844409c-239.8577 0-434.895573-195.037873-434.895573-434.895573 0-239.8577 195.037873-434.895573 434.895573-434.895573 239.755371 0 434.895573 195.037873 434.895573 434.895573C946.895573 751.806535 751.755371 946.844409 512 946.844409zM512 126.17088c-212.740682 0-385.880284 173.037274-385.880284 385.777955 0 212.740682 173.037274 385.777955 385.880284 385.777955 212.740682 0 385.777955-173.037274 385.777955-385.777955C897.777955 299.208154 724.740682 126.17088 512 126.17088z"
    p-id="3085"></path>
</svg>
</span> <span class="gt-ico-text">Markdown is supported</span></span></a> <!----> <button class="gt-btn gt-btn-preview"><span class="gt-btn-text">Preview</span> <!----></button> <button class="gt-btn gt-btn-login"><span class="gt-btn-text">Login with GitHub</span> <!----></button></div></div></div> <div class="gt-comments"><span></span> <p class="gt-comments-null">
                Be the first guy leaving a comment!
            </p> <!----></div></div></div></div></div> <!----></div> <div class="tool-group"><!----></div></div> <!----></div> <div class="background-mask" style="background:#f6f6f6;"></div></div></div>
    <script src="/blog/assets/js/app.d4bb39d4.js" defer></script><script src="/blog/assets/js/7.7ebaa5a1.js" defer></script>
  </body>
</html>
